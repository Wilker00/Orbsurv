
<!DOCTYPE html>
<html lang="en" data-require-dev>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin Logs - Orbsurv</title>
  <link rel="icon" type="image/x-icon" href="../Image/Group 213.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="../css/global.css">
  <link rel="stylesheet" href="../css/shared-vars.css">
  <link rel="stylesheet" href="../css/privacy.css">
  <link rel="stylesheet" href="../css/index.css">
  <link rel="stylesheet" href="../css/app.css">
  <link rel="stylesheet" href="../css/admin-logs.css">
</head>
<body class="admin-body">
  <header class="site-header" data-include="../header.html"></header>

  <main class="admin-main logs-main">
    <section class="admin-hero hero-gradient">
      <div class="wrap">
        <p class="hero-eyebrow">Developer Console</p>
        <h1>Server error logs</h1>
        <p class="hero-copy">Review API tracebacks and 5xx responses captured by Orbsurv. Use this view to triage launch incidents quickly.</p>
      </div>
    </section>

    <section class="wrap logs-summary" aria-label="Error log summary metrics">
      <article class="log-summary-card">
        <span class="log-summary-card__label">Last critical</span>
        <span class="log-summary-card__value">No incidents</span>
        <span class="log-summary-card__meta">Live since 08:00 UTC</span>
      </article>
      <article class="log-summary-card">
        <span class="log-summary-card__label">5xx (24h)</span>
        <span class="log-summary-card__value">0</span>
        <span class="log-summary-card__meta">Auto-refresh every 60s</span>
      </article>
      <article class="log-summary-card">
        <span class="log-summary-card__label">APM status</span>
        <span class="log-summary-card__value"><i class="fa-solid fa-signal"></i> Stable</span>
        <span class="log-summary-card__meta"><a href="../status.html">View uptime dashboard</a></span>
      </article>
    </section>

    <section class="wrap logs-layout">
      <article class="log-panel log-panel--table">
        <header class="log-panel__header">
          <h2>Recent errors</h2>
          <p>Ordered newest first. Export JSON or CSV from the main admin console.</p>
        </header>
        <div class="table-scroll">
          <table class="admin-table">
            <thead>
              <tr>
                <th scope="col">Timestamp</th>
                <th scope="col">Path</th>
                <th scope="col">Action</th>
                <th scope="col">Actor</th>
                <th scope="col">IP Address</th>
              </tr>
            </thead>
            <tbody id="logs-body">
              <tr>
                <td colspan="5" class="empty-state">Loading logs...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>

      <article class="log-panel log-panel--checklist">
        <header class="log-panel__header">
          <h2>Alerting checklist</h2>
          <p>Run through before marking an incident resolved.</p>
        </header>
        <ul class="log-checklist">
          <li class="log-checklist__item is-ready">
            <strong>Slack routing</strong>
            <p>5xx alerts sent to <code>#orbsurv-ops</code> via webhook.</p>
          </li>
          <li class="log-checklist__item is-ready">
            <strong>Pager rotation</strong>
            <p>Schedule synced with command center rotation.</p>
          </li>
          <li class="log-checklist__item">
            <strong>Client telemetry</strong>
            <p>Client-side errors stored under <code>client.error</code> audit actions.</p>
          </li>
        </ul>
        <footer class="log-panel__footer">
          <a class="btn btn-secondary btn-compact" href="../admin.html"><i class="fa-solid fa-arrow-up-right-from-square"></i> Open admin console</a>
          <a class="log-link" href="analytics.html">View analytics &rarr;</a>
        </footer>
      </article>
    </section>
  </main>

  <footer class="site-footer" data-include="../footer.html"></footer>

  <script src="../js/global.js"></script>
  <script src="../js/forms.js"></script>
  <script src="../js/auth-guard.js"></script>
  <script src="../js/admin-api.js"></script>
  <script src="../js/index.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const logsBody = document.getElementById('logs-body');
      if (!logsBody) return;

      // Ensure DEV role
      if (window.AuthGuard) {
        const hasDev = await window.AuthGuard.ensureDevRole();
        if (!hasDev) return;
      }

      try {
        const logsData = await window.AdminAPI.getLogs();
        const logs = logsData?.items || [];

        if (logs.length === 0) {
          logsBody.innerHTML = '<tr><td colspan="5" class="empty-state">No logs found.</td></tr>';
          return;
        }

        logsBody.innerHTML = logs.map(log => `
          <tr>
            <td>${window.AdminAPI.formatDate(log.created_at)}</td>
            <td><code>${log.path || 'N/A'}</code></td>
            <td><span class="status-badge">${log.action || 'N/A'}</span></td>
            <td>${log.actor_email || 'System'}</td>
            <td><code style="font-size: 0.75rem;">${log.ip || 'N/A'}</code></td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('Unable to load logs', error);
        window.AuthGuard?.handleAuthError(error);
        logsBody.innerHTML = '<tr><td colspan="5" class="empty-state">Unable to load logs. Please check your connection.</td></tr>';
      }
    });
  </script>
</body>
</html>







